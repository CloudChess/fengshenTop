import{_ as e,l as t,r as s,L as a,k as l,o as i,c as n,w as o,i as u,b as d,g as r,x as c,F as m,d as h,u as p,t as q,f,S as w,e as g,j as x,I as _,H as y,E as k,C as T}from"./index-BmSdLlR2.js";const A=e({data:()=>({eid:null,showQlistMethod:!1,currentQuestoin:0,questions:[{qid:0,qqid:0,qtype:"单选",title:"",answer:[{value:"",isAnswer:!0}],analysis:"",realAnswer:"",score:0}],examSetting:{examName:"",eCreateTime:null,limTime:{hour:0,min:0}},questionTags:["分值","题型","题目","答案","解析"],typeTags:{radio:"单选",check:"多选",jug:"判断",empty:"填空",shortT:"简答",draw:"画图"},settingTags:["试卷名","限定时间"]}),computed:{qt_list(){let e={radio:[],check:[],jug:[],empty:[],shortT:[],draw:[]};return this.questions.map((t=>{"单选"==t.qtype?e.radio.push(t):"多选"==t.qtype?e.check.push(t):"判断"==t.qtype?e.jug.push(t):"填空"==t.qtype?e.empty.push(t):"简答"==t.qtype?e.shortT.push(t):"画图"==t.qtype&&e.draw.push(t)})),e},totalScore(){let e=0;return this.questions.forEach((t=>{e+=Number(t.score)})),e}},methods:{sectionScore(e){let t=0;return this.questions.forEach((s=>{e==s.qtype&&(t+=Number(s.score))})),t},toQuestionHandle(e){let t=document.getElementById(e);t.offsetTop&&(t.scrollIntoView({behavior:"smooth",block:"center"}),this.currentQuestoin=e)},addQuestionHandle(){let e={qqid:this.questions.length,qtype:"单选",title:"",answer:[{value:"",isAnswer:!0}],analysis:"",realAnswer:"",score:"",isNew:!0};this.questions.push(e),setTimeout((()=>{this.toQuestionHandle(e.qqid)}),100)},delQuestion(e){if(this.questions.length>1)if(this.questions[e].isNew)this.questions.splice(e,1);else{let a=t("username"),l=t("token");s({url:"http://10.72.59.63:90/delQuestion.php",method:"POST",header:{Authorization:"Bearer "+l},data:{username:a,qid:this.questions[e].qid,eid:this.eid},success:t=>{t.data&&"success"==t.data.status&&this.questions.splice(e,1)}})}},delOptionHandle(e,t){if("填空"!=this.questions[e].qtype){if(this.questions[e].answer.length>2){let s=this.questions[e].answer[t].isAnswer,a=this.questions[e].qtype;this.questions[e].answer.splice(t,1),"单选"==a&&s&&(this.questions[e].answer[0].isAnswer=!0)}}else this.questions[e].answer.length>1&&this.questions[e].answer.splice(t,1)},changeRealAnswer(e,t,s){let a=this.questions[t].qtype;if("多选"==a){let e=[];this.questions[t].answer.forEach((t=>{t.isAnswer&&e.push(t.value)})),this.questions[t].realAnswer=e}else"单选"!=a&&"判断"!=a||(this.questions[t].realAnswer=e.detail.value)},addOptionHandle(e,t){if("多选"==t)this.questions[e].answer.push({value:"",isAnswer:!0});else if("单选"==t){let t={value:"",isAnswer:!1};this.questions[e].answer.push(t)}else"填空"==t&&this.questions[e].answer.push({text:""})},changeType(e,t){this.questions[e].qtype!=t&&("单选"==t?(this.questions[e].answer.forEach((e=>{e.isAnswer=!1})),this.questions[e].answer[0].isAnswer=!0):"多选"==t?this.questions[e].answer.length<=1&&this.questions[e].answer.push({value:"",isAnswer:!0}):"判断"==t?this.questions[e].answer=[{value:"对",isAnswer:!0},{value:"错",isAnswer:!1}]:"填空"==t&&(this.questions[e].answer=[{text:""}])),this.questions[e].qtype=t},setAnswer(e,t,s){if("多选"==e){let e=0,a=this.questions[t].answer;a.forEach((s=>{s.isAnswer&&(e++,this.questions[t].realAnswer=[],this.questions[t].realAnswer.push(s.value))})),e<=2&&1==this.questions[t].answer[s].isAnswer&&confirm("请注意多选题答案数量不要少于2"),this.questions[t].answer[s].isAnswer=!this.questions[t].answer[s].isAnswer,a.forEach((()=>{}))}else"单选"!=e&&"判断"!=e||(this.questions[t].answer.forEach((e=>{e.isAnswer=!1})),this.questions[t].answer[s].isAnswer=!0,this.questions[t].realAnswer=this.questions[t].answer[s].value)},checkFormat(e,t){if(e.detail&&e.detail.value){let s=e.detail.value;t&&(Number(s)>24||Number(s)<0)?this.examSetting.limTime.hour=null:!t&&(Number(s)>60||Number(s)<0)&&(this.examSetting.limTime.min=null)}},backHandle(){this.getOpenerEventChannel().emit("FinishPost"),a()},postQuestions(){if(this.questions[0]){let e=t("username"),a=t("token");if(!this.eid){let e=new Date;this.examSetting.eCreateTime=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}this.examSetting.examName||l({content:"请填写考试名称"});let i="",n=null,o=null;if(this.examSetting.limTime.hour||this.examSetting.limTime.min?(n=this.examSetting.limTime.hour,o=this.examSetting.limTime.min,n=n>=10?n:"0"+n,o=o>=10?o:"0"+o,i=n+":"+o+":00",this.examSetting.limTime=i):l({content:"请设置考试限时"}),this.examSetting.examName&&i){s({url:"http://10.72.59.63:90/postQuestions.php",method:"POST",header:{Authorization:"Bearer "+a},data:{username:e,questions:this.questions,examSetting:this.examSetting,eid:this.eid},success:e=>{if(e.data&&e.data.status)if("fail"==e.data.status)l({content:e.data.data});else if("success"==e.data.status){let e="添加考试成功";this.eid&&(e="修改成功"),l({content:e})}}})}this.examSetting.limTime={hour:Number(n),min:Number(o)}}},getPaper(){let e=t("username"),a=t("token");s({url:"http://10.72.59.63:90/getAlterExamPaper.php",method:"POST",header:{Authorization:"Bearer "+a},data:{username:e,eid:this.eid},success:e=>{if(e.data&&"success"==e.data.status){let t=e.data.examInfo,s=t.limTime;t.limTime={},t.limTime.hour=Number(s.split(":")[0]),t.limTime.min=Number(s.split(":")[1]),this.questions=e.data.questions,this.examSetting=t}}})}},onLoad(e){this.eid=e.eid,this.eid&&this.getPaper()}},[["render",function(e,t,s,a,l,A){const S=u,C=f,V=_,b=y,Q=k,v=T,O=w,H=g;return i(),n(S,{class:"addexam-pc"},{default:o((()=>[d(S,{class:"addexam-pc-background"}),d(S,{class:"addexam-container"},{default:o((()=>[d(S,{class:"addexam-list"},{default:o((()=>[(i(!0),r(m,null,c(l.questions,((t,s)=>(i(),n(S,{id:s,class:"addquestion"},{default:o((()=>[d(S,{class:"question-index"},{default:o((()=>[h("第"+q(s+1)+"题",1)])),_:2},1024),d(S,{class:"question-cancel",onClick:e=>A.delQuestion(s)},{default:o((()=>[h("x")])),_:2},1032,["onClick"]),(i(!0),r(m,null,c(l.questionTags,((a,u)=>(i(),n(S,{class:"question-row"},{default:o((()=>[d(C,{class:"question-tag"},{default:o((()=>[h(q(a)+"：",1)])),_:2},1024),d(S,{class:"question-container"},{default:o((()=>["分值"==a?(i(),n(S,{key:0,class:"question-score"},{default:o((()=>[d(V,{type:"text",modelValue:t.score,"onUpdate:modelValue":e=>t.score=e},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)):"题目"==a?(i(),n(b,{key:1,class:"question-txtInput",placeholder:"在此设置题目...",modelValue:t.title,"onUpdate:modelValue":e=>t.title=e},null,8,["modelValue","onUpdate:modelValue"])):"题型"==a?(i(),n(S,{key:2,class:"question-radios"},{default:o((()=>[(i(!0),r(m,null,c(l.typeTags,((e,a)=>(i(),n(S,{class:p(["questionRadio",{typeChecked:t.qtype==e}]),onClick:t=>A.changeType(s,e)},{default:o((()=>[h(q(e),1)])),_:2},1032,["class","onClick"])))),256))])),_:2},1024)):"答案"==a?(i(),n(S,{key:3,class:"question-options"},{default:o((()=>["单选"==t.qtype||"多选"==t.qtype||"判断"==t.qtype?(i(),n(S,{key:0,class:"objectiveQues"},{default:o((()=>[(i(!0),r(m,null,c(t.answer,((e,a)=>(i(),n(S,{class:"questionOption"},{default:o((()=>[d(V,{class:"questionOption-input",type:"text",placeholder:"在此设置选项...",modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,onInput:e=>A.changeRealAnswer(e,s,a)},null,8,["modelValue","onUpdate:modelValue","onInput"]),d(v,{class:"questionOption-answer"},{default:o((()=>[d(Q,{class:"answerCheck",checked:e.isAnswer,onClick:e=>A.setAnswer(t.qtype,s,a),value:e.value},null,8,["checked","onClick","value"]),d(C,null,{default:o((()=>[h("设为答案")])),_:1})])),_:2},1024),d(S,{class:"DeleteOptionBtn",onClick:e=>A.delOptionHandle(s,a)},{default:o((()=>[h("-")])),_:2},1032,["onClick"])])),_:2},1024)))),256)),d(S,{class:"question-add-option-btn",onClick:e=>A.addOptionHandle(s,t.qtype)},{default:o((()=>[h("添加选项")])),_:2},1032,["onClick"])])),_:2},1024)):x("",!0),"填空"==t.qtype?(i(),n(S,{key:1,class:"subjectiveQues"},{default:o((()=>[(i(!0),r(m,null,c(t.answer,(t=>(i(),n(S,{class:"questionOption"},{default:o((()=>[d(V,{class:"questionOption-input",modelValue:t.text,"onUpdate:modelValue":e=>t.text=e,type:"text",placeholder:"在此设置答案..."},null,8,["modelValue","onUpdate:modelValue"]),d(S,{class:"DeleteOptionBtn",onClick:t=>A.delOptionHandle(s,e.Oindex)},{default:o((()=>[h("-")])),_:2},1032,["onClick"])])),_:2},1024)))),256)),d(S,{class:"question-add-option-btn",onClick:e=>A.addOptionHandle(s,t.qtype)},{default:o((()=>[h("添加空位")])),_:2},1032,["onClick"])])),_:2},1024)):x("",!0)])),_:2},1024)):"解析"==a?(i(),n(b,{key:4,class:"question-txtInput",placeholder:"在此设置解析...",modelValue:t.analysis,"onUpdate:modelValue":e=>t.analysis=e},null,8,["modelValue","onUpdate:modelValue"])):x("",!0)])),_:2},1024)])),_:2},1024)))),256))])),_:2},1032,["id"])))),256)),d(S,{class:"addquestion-btn",onClick:t[0]||(t[0]=e=>A.addQuestionHandle())},{default:o((()=>[h("添加题目")])),_:1})])),_:1}),d(S,{class:"floatBoxLeft"},{default:o((()=>[d(S,{class:"addexam-qlist"},{default:o((()=>[d(S,{class:"togQlistMethod",onClick:t[1]||(t[1]=e=>l.showQlistMethod=!l.showQlistMethod)},{default:o((()=>[d(S,{class:"togSlider"},{default:o((()=>[d(S,{class:"sliderBox"},{default:o((()=>[d(S,{class:p(["sliderDiv",{sliderDivRight:l.showQlistMethod}])},null,8,["class"])])),_:1})])),_:1}),d(C,{class:"togDesTag"},{default:o((()=>[h("题号")])),_:1})])),_:1}),d(O,{class:"qList-scroll-view","scroll-y":"true"},{default:o((()=>[(i(!0),r(m,null,c(l.typeTags,((e,t)=>(i(),n(S,{class:"qlist-group"},{default:o((()=>[d(S,{class:"qlist-tag"},{default:o((()=>[d(C,{class:"qlist-tag-txt"},{default:o((()=>[h(q(e),1)])),_:2},1024),d(C,{class:"qlist-score-txt"},{default:o((()=>[h("分值："+q(A.sectionScore(e)),1)])),_:2},1024)])),_:2},1024),l.showQlistMethod?l.showQlistMethod?(i(),n(S,{key:1,class:"qlist-items"},{default:o((()=>[(i(!0),r(m,null,c(l.questions,((t,s)=>(i(),n(S,null,{default:o((()=>[t.qtype==e?(i(),n(S,{key:0,class:p(["qlist-item",{toQuestion:l.currentQuestoin==t.qqid}]),onClick:e=>A.toQuestionHandle(t.qqid)},{default:o((()=>[h(q(s+1),1)])),_:2},1032,["class","onClick"])):x("",!0)])),_:2},1024)))),256))])),_:2},1024)):x("",!0):(i(),n(S,{key:0,class:"qlist-items"},{default:o((()=>[(i(!0),r(m,null,c(A.qt_list[t],((e,t)=>(i(),n(v,{class:p(["qlist-item",{toQuestion:l.currentQuestoin==e.qqid}]),onClick:t=>A.toQuestionHandle(e.qqid)},{default:o((()=>[h(q(t+1),1)])),_:2},1032,["class","onClick"])))),256))])),_:2},1024))])),_:2},1024)))),256))])),_:1})])),_:1}),d(S,{class:"totalScore"},{default:o((()=>[d(C,{class:"totalScore-txt"},{default:o((()=>[h("总分值："+q(A.totalScore),1)])),_:1})])),_:1})])),_:1}),d(S,{class:"addexam-setting floatBox"},{default:o((()=>[(i(!0),r(m,null,c(l.settingTags,(e=>(i(),n(S,{class:"setting-item"},{default:o((()=>[d(S,{class:"setting-tag"},{default:o((()=>[h(q(e),1)])),_:2},1024),d(S,{class:"setting-box"},{default:o((()=>["试卷名"==e?(i(),n(V,{key:0,class:"settingBox-titleInput",placeholder:"请填写试卷名",modelValue:l.examSetting.examName,"onUpdate:modelValue":t[2]||(t[2]=e=>l.examSetting.examName=e),type:"text"},null,8,["modelValue"])):x("",!0),"限定时间"==e?(i(),n(S,{key:1,class:"settingBox-time"},{default:o((()=>[d(V,{class:"limtime-input",type:"number",modelValue:l.examSetting.limTime.hour,"onUpdate:modelValue":t[3]||(t[3]=e=>l.examSetting.limTime.hour=e),onInput:t[4]||(t[4]=e=>A.checkFormat(e,1))},null,8,["modelValue"]),h("时 "),d(V,{class:"limtime-input",type:"number",modelValue:l.examSetting.limTime.min,"onUpdate:modelValue":t[5]||(t[5]=e=>l.examSetting.limTime.min=e),onInput:t[6]||(t[6]=e=>A.checkFormat(e,0))},null,8,["modelValue"]),h("分 ")])),_:1})):x("",!0)])),_:2},1024)])),_:2},1024)))),256))])),_:1}),d(S,{class:"addexam-sub floatBox"},{default:o((()=>[d(H,{class:"subBtn",onClick:A.postQuestions},{default:o((()=>[h("提 交")])),_:1},8,["onClick"]),d(H,{class:"sub-cancel",onClick:t[7]||(t[7]=e=>A.backHandle())},{default:o((()=>[h("取消编辑并返回")])),_:1})])),_:1}),d(S,{class:"TopAndBottom floatBox"},{default:o((()=>[d(S,{class:"toTop toLabel",onClick:t[8]||(t[8]=e=>A.toQuestionHandle(0))},{default:o((()=>[h("顶")])),_:1}),d(S,{class:"tohr"}),d(S,{class:"toBottom toLabel",onClick:t[9]||(t[9]=e=>A.toQuestionHandle(l.questions.length-1))},{default:o((()=>[h("底")])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-373f2c9d"]]);export{A as default};
