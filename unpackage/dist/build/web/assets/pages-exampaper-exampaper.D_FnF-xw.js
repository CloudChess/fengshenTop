import{_ as e,y as s,l as a,r as t,k as l,z as i,m as n,o as d,c as o,w as u,b as r,d as c,g as p,x as h,F as m,i as f,A as _,e as w,S as k,t as q,j as y,u as v,f as C,B as g,C as b,D as x,E as F,G as A,I,H as Q,v as P,n as B,J as S}from"./index-BmSdLlR2.js";import{_ as H}from"./MyHeader.DeBaNa5e.js";import{r as j}from"./uni-app.es.YhHd3PI_.js";import{_ as E}from"./uni-drawer.B-Z5BQXI.js";const U=e({components:{examQlist:e({name:"examQlist",data:()=>({drawImgs:[],complateAnswer:[]}),props:{eid:null,isComplated:{default:!1},questions:[{isFinshed:!1,qtype:"",title:"",answer:[{value:"",isAnswer:!0}],uanswer:null,analysis:"",imageSrc:""}]},computed:{finshPercent(){let e=0,s=this.questions.length;return this.questions.forEach((s=>{s.isFinshed&&e++})),Math.floor(e/s*100)}},methods:{takePhoto(e){this.isComplated||s({count:1,success:s=>{if(s){let a=s.tempFilePaths[0];this.questions[e].imageSrc=a,this.questions[e].isFinshed=!0,this.drawImgs.push({name:this.questions[e].qid,uri:a})}}})},subQuestionHandle(e,s){e.detail.value?this.questions[s].isFinshed=!0:this.questions[s].isFinshed=!1},setAnswer(e,s){e.detail.value&&(this.questions[s].uanswer=e.detail.value,this.questions[s].isFinshed=!0,"多选"!=this.questions[s].qtype||this.questions[s].uanswer[0]||(this.questions[s].isFinshed=!1))},showQlistHandle(){this.$refs.showQlist.open()},jumpQuestion(e){let s=document.getElementsByClassName("exam-item")[e].offsetTop-100;window.scrollTo({top:s,left:0,behavior:"smooth"})},getUanswer(){let e=a("token"),s=a("username");t({url:"http://10.72.59.63:90/getUanswer.php",method:"POST",header:{Authorization:"Bearer "+e},data:{username:s,eid:this.eid},success:e=>{e.data&&e.data.data&&(console.log(e.data.data),this.complateAnswer=e.data.data)}})},subPaperHandle(){if(this.isComplated)l({content:"无法重复考试"});else{let e=!0;if(this.questions.forEach((s=>{0!=s.isFinshed&&s.isFinshed||(e=!1)})),e){let e=a("token"),s=a("username");i({url:"http://10.72.59.63:90/subPaper.php",header:{Authorization:"Bearer "+e},files:this.drawImgs,formData:{username:s,eid:this.eid,questions:JSON.stringify(this.questions)},success:e=>{let s=JSON.parse(JSON.parse(e.data));s&&"success"==s.state&&(this.$emit("updatecomplate",!1),l({content:"已提交"})),this.getOpenerEventChannel().emit("FinishExam")}})}else l({content:"请完成所有试题"})}}},mounted(){this.isComplated&&this.getUanswer()}},[["render",function(e,s,a,t,l,i){const B=f,S=_,H=w,U=C,V=g,N=b,T=x,O=F,z=A,J=I,M=Q,D=P,$=k,G=j(n("uni-drawer"),E);return d(),o(B,{class:"exam-qlist"},{default:u((()=>[r(B,{class:"stateNav"},{default:u((()=>[r(B,{class:"stateNav-blank"}),r(B,{class:"stateNav-main"},{default:u((()=>[r(B,{class:"processBox"},{default:u((()=>[r(S,{class:"process",percent:i.finshPercent,"show-info":""},null,8,["percent"])])),_:1}),r(B,{class:"stateBtns"},{default:u((()=>[r(H,{class:"showQlist",onClick:i.showQlistHandle},{default:u((()=>[c("题")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1}),r(B,{class:"qlist-container"},{default:u((()=>[(d(!0),p(m,null,h(a.questions,((e,s)=>(d(),o(B,{class:"exam-item"},{default:u((()=>["单选"==e.qtype?(d(),o(B,{key:0,class:"radio"},{default:u((()=>[r(U,{class:"question-title"},{default:u((()=>[r(U,{style:{"font-weight":"bold"}},{default:u((()=>[c("第"+q(s+1)+"题：",1)])),_:2},1024),c(q(e.title),1)])),_:2},1024),a.isComplated?(d(),o(B,{key:0,class:"options"},{default:u((()=>[(d(!0),p(m,null,h(e.answer,((e,t)=>(d(),o(N,{class:"option"},{default:u((()=>[r(V,{class:"radio-option",value:e.value,checked:e.value==l.complateAnswer[s].uanswer,disabled:a.isComplated},null,8,["value","checked","disabled"]),r(U,null,{default:u((()=>[c(q(e.value),1)])),_:2},1024)])),_:2},1024)))),256))])),_:2},1024)):(d(),o(T,{key:1,class:"options",onChange:e=>i.setAnswer(e,s)},{default:u((()=>[(d(!0),p(m,null,h(e.answer,((e,s)=>(d(),o(N,{class:"option"},{default:u((()=>[r(V,{class:"radio-option",value:e.value,disabled:a.isComplated},null,8,["value","disabled"]),r(U,null,{default:u((()=>[c(q(e.value),1)])),_:2},1024)])),_:2},1024)))),256))])),_:2},1032,["onChange"]))])),_:2},1024)):y("",!0),"多选"==e.qtype?(d(),o(B,{key:1,class:"choices"},{default:u((()=>[r(U,{class:"question-title"},{default:u((()=>[r(U,{style:{"font-weight":"bold"}},{default:u((()=>[c("第"+q(s+1)+"题：",1)])),_:2},1024),c(q(e.title),1)])),_:2},1024),a.isComplated?(d(),o(B,{key:0,class:"options"},{default:u((()=>[(d(!0),p(m,null,h(e.answer,((e,t)=>(d(),o(N,{class:"option"},{default:u((()=>[r(V,{class:"radio-option",value:e.value,checked:l.complateAnswer[s].uanswer.include(e.value),disabled:a.isComplated},null,8,["value","checked","disabled"]),r(U,null,{default:u((()=>[c(q(e.value),1)])),_:2},1024)])),_:2},1024)))),256))])),_:2},1024)):y("",!0),r(z,{class:"options",onChange:e=>i.setAnswer(e,s)},{default:u((()=>[(d(!0),p(m,null,h(e.answer,((e,s)=>(d(),o(N,{class:"option"},{default:u((()=>[r(O,{value:e.value,disabled:a.isComplated},null,8,["value","disabled"]),r(U,null,{default:u((()=>[c(q(e.value),1)])),_:2},1024)])),_:2},1024)))),256))])),_:2},1032,["onChange"])])),_:2},1024)):y("",!0),"判断"==e.qtype?(d(),o(B,{key:2,class:"judgment"},{default:u((()=>[r(U,{class:"question-title"},{default:u((()=>[r(U,{style:{"font-weight":"bold"}},{default:u((()=>[c("第"+q(s+1)+"题：",1)])),_:2},1024),c(q(e.title),1)])),_:2},1024),a.isComplated?(d(),o(B,{key:0,class:"options"},{default:u((()=>[(d(!0),p(m,null,h(e.answer,((e,t)=>(d(),o(N,{class:"option"},{default:u((()=>[r(V,{class:"radio-option",value:e.value,checked:e.value==l.complateAnswer[s].uanswer,disabled:a.isComplated},null,8,["value","checked","disabled"]),r(U,null,{default:u((()=>[c(q(e.value),1)])),_:2},1024)])),_:2},1024)))),256))])),_:2},1024)):y("",!0),r(T,{class:"options",onChange:e=>i.setAnswer(e,s)},{default:u((()=>[(d(!0),p(m,null,h(e.answer,((e,s)=>(d(),o(N,{class:"option"},{default:u((()=>[r(V,{class:"radio-option",value:e.value,disabled:a.isComplated},null,8,["value","disabled"]),r(U,null,{default:u((()=>[c(q(e.value),1)])),_:2},1024)])),_:2},1024)))),256))])),_:2},1032,["onChange"])])),_:2},1024)):y("",!0),"填空"==e.qtype?(d(),o(B,{key:3,class:"empty"},{default:u((()=>[r(U,{class:"question-title"},{default:u((()=>[r(U,{style:{"font-weight":"bold"}},{default:u((()=>[c("第"+q(s+1)+"题：",1)])),_:2},1024),c(q(e.title),1)])),_:2},1024),r(B,{class:"emptyInputs"},{default:u((()=>[r(J,{class:"emptyInput txtInput",type:"text",modelValue:e.uanswer,"onUpdate:modelValue":s=>e.uanswer=s,onInput:e=>i.subQuestionHandle(e,s),disabled:a.isComplated},null,8,["modelValue","onUpdate:modelValue","onInput","disabled"])])),_:2},1024)])),_:2},1024)):y("",!0),"简答"==e.qtype?(d(),o(B,{key:4,class:"shortT"},{default:u((()=>[r(U,{class:"question-title"},{default:u((()=>[r(U,{style:{"font-weight":"bold"}},{default:u((()=>[c("第"+q(s+1)+"题：",1)])),_:2},1024),c(q(e.title),1)])),_:2},1024),a.isComplated?(d(),o(B,{key:0,class:"shortTxt"},{default:u((()=>[c(q(l.complateAnswer[s].uanswer),1)])),_:2},1024)):(d(),o(M,{key:1,class:"shortTxt txtInput",maxlength:-1,modelValue:e.uanswer,"onUpdate:modelValue":s=>e.uanswer=s,onInput:e=>i.subQuestionHandle(e,s),disabled:a.isComplated},null,8,["modelValue","onUpdate:modelValue","onInput","disabled"]))])),_:2},1024)):y("",!0),"画图"==e.qtype?(d(),o(B,{key:5,class:"draw"},{default:u((()=>[r(U,{class:"question-title"},{default:u((()=>[r(U,{style:{"font-weight":"bold"}},{default:u((()=>[c("第"+q(s+1)+"题：",1)])),_:2},1024),c(q(e.title),1)])),_:2},1024),a.isComplated?(d(),o(D,{key:0,class:"cameraSelect",src:l.complateAnswer[s].drawImg},null,8,["src"])):(d(),o(D,{key:1,class:"cameraSelect",src:e.imageSrc,onClick:e=>i.takePhoto(s)},null,8,["src","onClick"]))])),_:2},1024)):y("",!0)])),_:2},1024)))),256))])),_:1}),r(G,{ref:"showQlist",mode:"right",maskClick:!0},{default:u((()=>[r($,{style:{height:"100%"},"scroll-y":"true"},{default:u((()=>[r(B,{class:"QlistBox"},{default:u((()=>[(d(!0),p(m,null,h(a.questions,((e,s)=>(d(),o(B,{class:v(["QlistItem",{ItemFinshed:1==e.isFinshed}]),onClick:e=>i.jumpQuestion(s)},{default:u((()=>[c(q(s+1),1)])),_:2},1032,["class","onClick"])))),256))])),_:1}),r(H,{class:"subPaperBtn",onClick:i.subPaperHandle},{default:u((()=>[c("提交试卷")])),_:1},8,["onClick"])])),_:1})])),_:1},512)])),_:1})}],["__scopeId","data-v-6c506e0f"]])},data:()=>({username:"",isFinished:"",eid:0,questions:[]}),methods:{updatecomplate(){this.isFinished=!0},handleBack(){B({url:"/pages/index/index"})},getExamPaper(){let e=a("username"),s=a("token");t({url:"http://10.72.59.63:90/getExamPaper.php",method:"POST",header:{Authorization:"Bearer "+s},data:{username:e,eid:this.eid},success:e=>{e.data&&e.data.data&&(this.questions=e.data.data)}})}},onLoad(e){this.username=a("username"),this.isFinished="已完成"==e.isFinished,this.eid=e.eid,this.getExamPaper(this.eid)}},[["render",function(e,s,a,t,l,i){const c=j(n("MyHeader"),H),p=S("examQlist"),h=f;return d(),o(h,null,{default:u((()=>[r(h,{class:"exampaper"},{default:u((()=>[r(c,{title:"考试",sureBack:!0}),r(p,{questions:l.questions,isComplated:l.isFinished,eid:l.eid,onUpdatecomplate:i.updatecomplate},null,8,["questions","isComplated","eid","onUpdatecomplate"])])),_:1})])),_:1})}]]);export{U as default};
